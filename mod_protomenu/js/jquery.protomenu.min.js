/**
 * @package        HEAD. Protomenü 2
 * @version        2.1.0
 * 
 * @author         Carsten Ruppert <webmaster@headmarketing.de>
 * @link           https://www.headmarketing.de
 * @copyright      Copyright © 2018 HEAD. MARKETING GmbH All Rights Reserved
 * @license        http://www.gnu.org/licenses/gpl-2.0.html GNU/GPL
 */
(function(b){b.Protomenu=function(a,c){this.$node=b(c);this.$node.data("protomenu",this);this._init(a)};b.Protomenu.defaults={classNames:{open:"open","in":"in"},seperateswitch:!1,mouseover:!1,clickAnywhere:!1,plugins:[]};b.Protomenu.Plugins=[];b.Protomenu.prototype={_init:function(a){this.opt=b.extend({},b.Protomenu.defaults,a);this.$menu=this.$node.find(".nav-first");this.setupTriggers();this.setupEvents();this.opt.plugins=this.opt.plugins.concat(b.Protomenu.Plugins);this.opt.plugins=this.opt.plugins.filter(function(a,
    c,b){return b.indexOf(a)===c});if(0<this.opt.plugins.length){a=0;for(var c=this.opt.plugins.length;a<c;a++)this[this.opt.plugins[a]]=new b[this.opt.plugins[a]](this)}},attachTriggerEvent:function(a){var c=this;if(this.opt.mouseover)a.on("mouseover.protomenu",function(a){var d=b(this);d.data("ptmenu")&&a.stopPropagation();c.toggleSubmenu(d,!0)}),a.on("touchend.protomenu",function(a){var d=b(this);d.data("ptmenu")&&(a.preventDefault(),a.stopPropagation());c.toggleSubmenu(d)});else a.on("click.protomenu",
    function(a){var d=b(this);d.data("ptmenu")&&(a.preventDefault(),a.stopPropagation());c.toggleSubmenu(d)})},setupEvents:function(){var a=this;if(this.opt.clickAnywhere)b(document).on("click",function(c){a.closeRootLevel()});this.$node.find(".nav-module, .nav-child-toolbar, .nav-item, .nav-container-toolbar").on("click.protomenu",function(a){a.stopPropagation()})},setupTriggers:function(){this.$submenus=this.$menu.find(".nav-container, .nav-child").not(".mega .nav-child .nav-child");for(var a=0,c=this.$submenus.length;a<
    c;a++){for(var b=this.$submenus.eq(a),e=this.$menu.find(".trigger-"+b.attr("id")),h=0,l=e.length;h<l;h++){var g=e.eq(h),k={submenu:b},f=g.children(".item-switch");g=f.length&&this.opt.seperateswitch?f:g;g.data("ptmenu",k)}k={triggers:e};b.data("ptmenu",k)}this.items=this.$menu.find(".nav-item");for(a=0;a<this.items.length;a++)c=this.items.eq(a),f=c.children(".item-switch"),this.attachTriggerEvent(f.length&&this.opt.seperateswitch?f:c)},disableTriggers:function(a){a.data("ptmenu").triggers.removeClass(this.opt.classNames.open);
    a=a.find(".nav-child");for(var c=0,b=a.length;c<b;c++){var e=a.eq(c).data("ptmenu");e&&e.triggers.removeClass(this.opt.classNames.open)}},disableDescestors:function(a){a.find(".nav-child").removeClass(b.map(this.opt.classNames,function(a){return a}).join(" "))},disableAfterTransition:function(a){a.removeClass(this.opt.classNames["in"]);this.disableDescestors(a)},hideSub:function(a){var c=a.css("transition-duration").split(","),d=a.data("ptmenu"),e=0;c.forEach(function(a){a=parseFloat(a);e=a>e?a:e});
    0<e?(d.timeout=window.setTimeout(this.disableAfterTransition.bind(this,a),1E3*e),a.data("ptmenu",d),a.removeClass(this.opt.classNames.open)):(a.removeClass(b.map(this.opt.classNames,function(a){return a}).join(" ")),this.disableDescestors(a));this.disableTriggers(a);this.$node.triggerHandler("afterStateChanged")},showSub:function(a){var c=a.data("ptmenu");c.timeout&&this.opt.mouseover&&window.clearTimeout(c.timeout);this.closeEqualLevel(a);a.addClass(b.map(this.opt.classNames,function(a){return a}).join(" "));
    c.triggers.addClass(this.opt.classNames.open);this.$node.triggerHandler("afterStateChanged")},closeRootLevel:function(){var a=this.$menu.find(".nav-child.nav-level-2."+this.opt.classNames.open);a.length&&this.hideSub(a)},closeEqualLevel:function(a){a=a.parent().parent().find(".nav-child."+this.opt.classNames.open).not(a);for(var c=0,b=a.length;c<b;c++)this.hideSub(a.eq(c))},isExpanded:function(a){return(a?this.$menu.find(".nav-child.nav-level-2."+this.opt.classNames.open):this.$menu.find(".nav-child."+
    this.opt.classNames.open)).length?!0:!1},toggleSubmenu:function(a,c){if(a.data("ptmenu")){var d=a.data("ptmenu").submenu;d.hasClass(this.opt.classNames.open)&&!c?(this.hideSub(d),a.blur()):this.showSub(d);if(c){var e=this;this.$menu.children("li").off("mousemove.protomenu").on("mousemove.protomenu",function(a){b(this).find("#"+d.attr("id")).length||(b(document).off("mousemove.protomenu"),e.closeRootLevel())});b(document).off("mousemove.protomenu").on("mousemove.protomenu",function(a){b(a.target).parents(".ptmenu").length||
    (b(document).off("mousemove.protomenu"),e.closeRootLevel())})}}else c&&this.closeEqualLevel(a)}};b.fn.protomenu=function(a){var c=b(this).data("protomenu");void 0===c&&(c=new b.Protomenu(a,this));return c}})(jQuery);
    (function(b){b.Protomenu.defaults.backDrop={template:'<div class="ptmenu-backdrop"></div>'};b.ProtomenuBackdrop=function(a){this.parent=a;this._init()};b.ProtomenuBackdrop.prototype={_init:function(){var a=this;this.backdrop=b(this.parent.opt.backDrop.template);this.timer=null;b("body").prepend(this.backdrop);this.parent.$node.on("afterStateChanged",function(c){a.parent.isExpanded(!0)?a.backdrop.addClass(b.map(a.parent.opt.classNames,function(a){return a}).join(" ")):a.close()})},close:function(){window.clearTimeout(this.timer);
    var a=0;this.backdrop.css("transition-duration").split(",").forEach(function(b){b=parseFloat(b);a=b>a?b:a});this.timer=window.setTimeout(function(){this.parent.isExpanded()||this.backdrop.removeClass(this.parent.opt.classNames["in"])}.bind(this),1E3*a);this.backdrop.removeClass(this.parent.opt.classNames.open)}};b.Protomenu.Plugins.push("ProtomenuHtml5Video");b.Protomenu.defaults.html5video={autoplay:!0};b.ProtomenuHtml5Video=function(a){this.parent=a;this._init()};b.ProtomenuHtml5Video.prototype=
    {_init:function(){var a=this;this.parent.on("afterStateChanged",function(){a.tick()})},tick:function(){var a=this,c=this.$node.find(".nav-level-2.open");if(video=this.getVideoObject(c))if(2<=video.readyState)this.playVideo();else b(video).one("canplay.protomenu.html5video",function(){a.playVideo()})},getVideoObject:function(a){a=a.find("video");return a.length?a.get(0):!1},playVideo:function(){var a=this.getVideoObject(this.parent.State.stage[0]);if(a){var c=b(a).data("ptoptions")||{};(this.parent.options.html5video.autoplay||
    c.autoplay)&&a.play()}}}})(jQuery);