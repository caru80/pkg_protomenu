/**
	Protomenu 2.0.0
	Carsten Ruppert - 2018-02-23

	2.0.0 - 2018-02-23
	- Plugins können nun auch dynamisch pro Instant geladen werden, nicht mehr nur für alle Instanzen
	- Fix von statischen CSS-Klassennamen im Code
	- Doppeltes auslösen von Event afterStateChanged korrigiert

	0.12.0 - 2018-02-22
	- Fix der Plugin-Logik. Es wurde immer ein und die gleiche Instanz eines Plugin-Objekts (Backdrop) benutzt, egal wieviele Instanzen von Protomenu existierten.
	- Fix von Backdrop-Plugin

	0.11.0 – 2017-11-29
	- Unterscheidung Touch und Mouseover, wenn Option „Mouseover” eingeschaltet ist.
	- etc.

	0.10.0 – 2017-11-06
	- Entkernt!
	- Abhängigkeit von $.prepareTransition entfernt
	- Abhängigkeit von $.touchSwipe entfernt
*/
'use strict';
(function(c){c.Protomenu=function(a,b){this.$node=c(b);this.$node.data("protomenu",this);this._init(a)};c.Protomenu.defaults={classNames:{open:"open","in":"in"},seperateswitch:!1,mouseover:!1,clickAnywhere:!1,plugins:[]};c.Protomenu.Plugins=[];c.Protomenu.prototype={_init:function(a){this.opt=c.extend({},c.Protomenu.defaults,a);this.$menu=this.$node.find(".nav-first");this.setupTriggers();this.setupEvents();this.opt.plugins=this.opt.plugins.concat(c.Protomenu.Plugins);this.opt.plugins=this.opt.plugins.filter(function(a,
b,c){return c.indexOf(a)===b});if(0<this.opt.plugins.length){a=0;for(var b=this.opt.plugins.length;a<b;a++)this[this.opt.plugins[a]]=new c[this.opt.plugins[a]](this)}},attachTriggerEvent:function(a){var b=this;if(this.opt.mouseover)a.on("mouseover.protomenu",function(a){var d=c(this);d.data("ptmenu")&&a.stopPropagation();b.toggleSubmenu(d,!0)}),a.on("touchend.protomenu",function(a){var d=c(this);d.data("ptmenu")&&(a.preventDefault(),a.stopPropagation());b.toggleSubmenu(d)});else a.on("click.protomenu",
function(a){var d=c(this);d.data("ptmenu")&&(a.preventDefault(),a.stopPropagation());b.toggleSubmenu(d)})},setupEvents:function(){var a=this;if(this.opt.clickAnywhere)c(document).on("click",function(b){a.closeRoot()});this.$node.find(".nav-module, .nav-child-toolbar, .nav-item, .nav-container-toolbar").on("click.protomenu",function(a){a.stopPropagation()})},setupTriggers:function(){this.$submenus=this.$menu.find(".nav-container, .nav-child").not(".mega .nav-child .nav-child");for(var a=0,b=this.$submenus.length;a<
b;a++){for(var c=this.$submenus.eq(a),e=this.$menu.find(".trigger-"+c.attr("id")),h=0,l=e.length;h<l;h++){var g=e.eq(h),k={submenu:c},f=g.children(".item-switch");g=f.length&&this.opt.seperateswitch?f:g;g.data("ptmenu",k)}k={triggers:e};c.data("ptmenu",k)}this.items=this.$menu.find(".nav-item");for(a=0;a<this.items.length;a++)b=this.items.eq(a),f=b.children(".item-switch"),this.attachTriggerEvent(f.length&&this.opt.seperateswitch?f:b)},disableTriggers:function(a){a.data("ptmenu").triggers.removeClass(this.opt.classNames.open);
a=a.find(".nav-child");for(var b=0,c=a.length;b<c;b++)a.eq(b).data("ptmenu").triggers.removeClass(this.opt.classNames.open)},disableDescestors:function(a){a.find(".nav-child").removeClass(c.map(this.opt.classNames,function(a){return a}).join(" "))},hideSub:function(a){var b=0;a.css("transition-duration").split(",").forEach(function(a){a=parseFloat(a);b=a>b?a:b});0<b?(window.setTimeout(function(a){a.removeClass(this.opt.classNames["in"]);this.disableDescestors(a)}.bind(this,a),1E3*b),a.removeClass(this.opt.classNames.open)):
(a.removeClass(c.map(this.opt.classNames,function(a){return a}).join(" ")),this.disableDescestors(a));this.$node.triggerHandler("afterStateChanged");this.disableTriggers(a)},showSub:function(a){this.closeEqual(a);a.addClass(c.map(this.opt.classNames,function(a){return a}).join(" "));a.data("ptmenu").triggers.addClass(this.opt.classNames.open);this.$node.triggerHandler("afterStateChanged")},closeRoot:function(){var a=this.$menu.find(".nav-child.nav-level-2."+this.opt.classNames.open);a.length&&this.hideSub(a)},
closeEqual:function(a){a=a.parent().parent().find(".nav-child."+this.opt.classNames.open).not(a);for(var b=0,c=a.length;b<c;b++)this.hideSub(a.eq(b))},isExpanded:function(a){return(a?this.$menu.find(".nav-child.nav-level-2."+this.opt.classNames.open):this.$menu.find(".nav-child."+this.opt.classNames.open)).length?!0:!1},toggleSubmenu:function(a,b){if(a.data("ptmenu")){var d=a.data("ptmenu").submenu;d.hasClass(this.opt.classNames.open)&&!b?(this.hideSub(d),a.blur()):this.showSub(d);if(b){var e=this;
this.$menu.children("li").off("mousemove.protomenu").on("mousemove.protomenu",function(a){c(this).find("#"+d.attr("id")).length||(c(document).off("mousemove.protomenu"),e.closeRoot())});c(document).off("mousemove.protomenu").on("mousemove.protomenu",function(a){c(a.target).parents(".ptmenu").length||(c(document).off("mousemove.protomenu"),e.closeRoot())})}}else b&&this.closeEqual(a)}};c.fn.protomenu=function(a){var b=c(this).data("protomenu");void 0===b&&(b=new c.Protomenu(a,this));return b}})(jQuery);
(function(c){c.Protomenu.defaults.backDrop={template:'<div class="ptmenu-backdrop"></div>'};c.ProtomenuBackdrop=function(a){this.parent=a;this._init()};c.ProtomenuBackdrop.prototype={_init:function(){var a=this;this.backdrop=c(this.parent.opt.backDrop.template);this.timer=null;c("body").prepend(this.backdrop);this.parent.$node.on("afterStateChanged",function(b){a.parent.isExpanded(!0)?a.backdrop.addClass(c.map(a.parent.opt.classNames,function(a){return a}).join(" ")):a.close()})},close:function(){window.clearTimeout(this.timer);
var a=0;this.backdrop.css("transition-duration").split(",").forEach(function(b){b=parseFloat(b);a=b>a?b:a});this.timer=window.setTimeout(function(){this.parent.isExpanded()||this.backdrop.removeClass(this.parent.opt.classNames["in"])}.bind(this),1E3*a);this.backdrop.removeClass(this.parent.opt.classNames.open)}}})(jQuery);
